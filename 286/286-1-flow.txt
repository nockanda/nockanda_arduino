[{"id":"d00468c7.f49a28","type":"tab","label":"플로우 2","disabled":false,"info":""},{"id":"b94b96c7.787ef8","type":"mqtt in","z":"d00468c7.f49a28","name":"","topic":"nockanda/state","qos":"2","datatype":"auto","broker":"b300b90d.5b3268","nl":false,"rap":true,"rh":0,"x":140,"y":100,"wires":[["df7f141b.ee5478","ae34de42.f0a4c"]]},{"id":"4cfe417e.cfc49","type":"ui_text","z":"d00468c7.f49a28","group":"dcdc0d14.9c98e","order":0,"width":0,"height":0,"name":"","label":"text","format":"{{msg.payload}}","layout":"row-spread","x":530,"y":160,"wires":[]},{"id":"f036857b.a1b378","type":"inject","z":"d00468c7.f49a28","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"5","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"오프라인","payloadType":"str","x":130,"y":200,"wires":[["555a0c45.9c2874"]]},{"id":"555a0c45.9c2874","type":"delay","z":"d00468c7.f49a28","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":320,"y":260,"wires":[["4cfe417e.cfc49","ef478ea7.f5617"]]},{"id":"df7f141b.ee5478","type":"function","z":"d00468c7.f49a28","name":"","func":"flow.set(\"state\",msg.payload);\n\nmsg.reset = true;\nmsg.payload = \"온라인\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":300,"y":160,"wires":[["555a0c45.9c2874","4cfe417e.cfc49"]]},{"id":"ae34de42.f0a4c","type":"ui_text","z":"d00468c7.f49a28","group":"dcdc0d14.9c98e","order":0,"width":0,"height":0,"name":"","label":"MQTT메시지","format":"{{msg.payload}}","layout":"row-spread","x":490,"y":100,"wires":[]},{"id":"254da195.77d63e","type":"mqtt out","z":"d00468c7.f49a28","name":"","topic":"nockanda/light","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"b300b90d.5b3268","x":440,"y":320,"wires":[]},{"id":"c48bc331.07461","type":"ui_button","z":"d00468c7.f49a28","name":"","group":"dcdc0d14.9c98e","order":2,"width":0,"height":0,"passthru":false,"label":"ON button","tooltip":"","color":"","bgcolor":"","icon":"","payload":"1","payloadType":"str","topic":"topic","topicType":"msg","x":150,"y":300,"wires":[["254da195.77d63e"]]},{"id":"88e1da5d.abbb08","type":"ui_button","z":"d00468c7.f49a28","name":"","group":"dcdc0d14.9c98e","order":3,"width":0,"height":0,"passthru":false,"label":"OFF button","tooltip":"","color":"","bgcolor":"","icon":"","payload":"0","payloadType":"str","topic":"topic","topicType":"msg","x":150,"y":340,"wires":[["254da195.77d63e"]]},{"id":"c7688a21.d98c18","type":"mqtt in","z":"d00468c7.f49a28","name":"","topic":"nockanda/sct013-030","qos":"2","datatype":"auto","broker":"b300b90d.5b3268","nl":false,"rap":true,"rh":0,"x":120,"y":540,"wires":[["a4fc0ecb.83d14"]]},{"id":"32781daf.9068e2","type":"ui_text","z":"d00468c7.f49a28","group":"59341cab.141a64","order":0,"width":0,"height":0,"name":"","label":"샘플링타임","format":"{{msg.payload.time}}","layout":"row-spread","x":510,"y":540,"wires":[]},{"id":"a4fc0ecb.83d14","type":"json","z":"d00468c7.f49a28","name":"","property":"payload","action":"","pretty":false,"x":310,"y":540,"wires":[["32781daf.9068e2","1cf81d0a.6a8853","3700db1e.d228d4","ddf625ec.3ff5e8","375ea0af.15fa7"]]},{"id":"1cf81d0a.6a8853","type":"ui_text","z":"d00468c7.f49a28","group":"59341cab.141a64","order":0,"width":0,"height":0,"name":"","label":"누적전력량","format":"{{msg.payload.WH}}","layout":"row-spread","x":510,"y":580,"wires":[]},{"id":"3700db1e.d228d4","type":"ui_text","z":"d00468c7.f49a28","group":"59341cab.141a64","order":0,"width":0,"height":0,"name":"","label":"순간전력","format":"{{msg.payload.W}}","layout":"row-spread","x":500,"y":620,"wires":[]},{"id":"ddf625ec.3ff5e8","type":"ui_text","z":"d00468c7.f49a28","group":"59341cab.141a64","order":0,"width":0,"height":0,"name":"","label":"순간전류","format":"{{msg.payload.A}}","layout":"row-spread","x":500,"y":660,"wires":[]},{"id":"273be36c.e11ddc","type":"ui_text","z":"d00468c7.f49a28","group":"59341cab.141a64","order":0,"width":0,"height":0,"name":"","label":"접속유무","format":"{{msg.payload}}","layout":"row-spread","x":500,"y":700,"wires":[]},{"id":"804dcbf2.8959b8","type":"inject","z":"d00468c7.f49a28","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"5","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"오프라인","payloadType":"str","x":90,"y":600,"wires":[["ca8f8807.468248"]]},{"id":"ca8f8807.468248","type":"delay","z":"d00468c7.f49a28","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":280,"y":660,"wires":[["273be36c.e11ddc","a9189a1.0f38e68"]]},{"id":"375ea0af.15fa7","type":"function","z":"d00468c7.f49a28","name":"","func":"flow.set(\"stime\",msg.payload.time);\nflow.set(\"wh\",msg.payload.WH);\nflow.set(\"w\",msg.payload.W);\nflow.set(\"a\",msg.payload.A);\n\nmsg.reset = true;\nmsg.payload = \"온라인\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":300,"y":600,"wires":[["ca8f8807.468248","273be36c.e11ddc"]]},{"id":"5c0606ca.2744b8","type":"mysql","z":"d00468c7.f49a28","mydb":"32efad14.604282","name":"","x":490,"y":40,"wires":[[]]},{"id":"35cbdae0.29fd96","type":"function","z":"d00468c7.f49a28","name":"","func":"var date = new Date().getTime();\nvar data = flow.get(\"state\");\nif(data == null) data = -999;\n\nmsg.topic = \"insert into light values('\"+data+\"','\"+date+\"')\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":280,"y":40,"wires":[["5c0606ca.2744b8"]]},{"id":"d481f56c.70f8b8","type":"ui_table","z":"d00468c7.f49a28","group":"91f945bf.3f26b8","name":"","order":1,"width":"6","height":"6","columns":[],"outputs":0,"cts":false,"x":530,"y":380,"wires":[]},{"id":"d1939942.65f578","type":"ui_button","z":"d00468c7.f49a28","name":"","group":"91f945bf.3f26b8","order":0,"width":0,"height":0,"passthru":false,"label":"전구제어기록보기","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"select * from light order by date desc limit 10","topicType":"str","x":130,"y":380,"wires":[["4bf9dcab.b6f104"]]},{"id":"4bf9dcab.b6f104","type":"mysql","z":"d00468c7.f49a28","mydb":"32efad14.604282","name":"","x":330,"y":380,"wires":[["d481f56c.70f8b8"]]},{"id":"3a2b73bf.4cda4c","type":"mysql","z":"d00468c7.f49a28","mydb":"32efad14.604282","name":"","x":490,"y":480,"wires":[[]]},{"id":"30f49ab3.90b346","type":"function","z":"d00468c7.f49a28","name":"","func":"var date = new Date().getTime();\n\nvar data1 = flow.get(\"stime\");\nvar data2 = flow.get(\"wh\");\nvar data3 = flow.get(\"w\");\nvar data4 = flow.get(\"a\");\nif(data1==null) data1=-999;\nif(data2==null) data2=-999;\nif(data3==null) data3=-999;\nif(data4==null) data4=-999;\n\nmsg.topic = \"insert into sct013 values(\"+data1+\",\"+data2+\",\"+data3+\",\"+data4+\",'\"+date+\"')\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":320,"y":480,"wires":[["3a2b73bf.4cda4c"]]},{"id":"b43b8d13.26f25","type":"function","z":"d00468c7.f49a28","name":"","func":"var date1 = new Date();\nvar date2 = new Date();\n\ndate2.setSeconds(date2.getSeconds()-60);\n\n//msg.payload = [date1.getTime(),date2.getTime()];\n\nmsg.topic = \"select * from sct013 where date >= '\"+date2.getTime()+\"' AND date <= '\"+date1.getTime()+\"'\";\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":280,"y":780,"wires":[["e6674b98.2bb1f8"]]},{"id":"76364cf6.cf5364","type":"ui_table","z":"d00468c7.f49a28","group":"f3f80c78.df78","name":"","order":1,"width":"6","height":"6","columns":[],"outputs":0,"cts":false,"x":510,"y":780,"wires":[]},{"id":"e6674b98.2bb1f8","type":"mysql","z":"d00468c7.f49a28","mydb":"32efad14.604282","name":"","x":350,"y":860,"wires":[["76364cf6.cf5364","de6bbcf2.44adc"]]},{"id":"e373241b.4675c8","type":"ui_button","z":"d00468c7.f49a28","name":"","group":"f3f80c78.df78","order":2,"width":0,"height":0,"passthru":false,"label":"전력량출력하기!","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"topic","topicType":"msg","x":120,"y":780,"wires":[["b43b8d13.26f25"]]},{"id":"c1f7be81.8e911","type":"ui_chart","z":"d00468c7.f49a28","name":"","group":"f3f80c78.df78","order":0,"width":0,"height":0,"label":"순간전력그래프","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"x":520,"y":940,"wires":[[]]},{"id":"de6bbcf2.44adc","type":"function","z":"d00468c7.f49a28","name":"","func":"var input = msg.payload;\n\nvar data1 = {payload:[]};\nvar data2 = {payload:[]};\nvar data3 = {payload:[]};\n\nvar y1=[];\nvar y2=[];\nvar y3=[];\nvar x=[];\n\nfor(var i = 0;i<input.length;i++){\n    if(input[i].sct_w == -999){\n        y1.push(0); \n        y2.push(0); \n        y3.push(0); \n    }else{\n        y1.push(input[i].sct_w);\n        y2.push(input[i].sct_a);\n        y3.push(input[i].sct_wh);\n    }\n    \n    x.push(input[i].date);\n}\n\ndata1.payload = [{\n    series:\"\",\n    data:[y1],\n    labels:x\n    \n}];\ndata2.payload = [{\n    series:\"\",\n    data:[y2],\n    labels:x\n    \n}];\ndata3.payload = [{\n    series:\"\",\n    data:[y3],\n    labels:x\n    \n}];\n\nreturn [data1,data2,data3];","outputs":3,"noerr":0,"initialize":"","finalize":"","libs":[],"x":320,"y":980,"wires":[["c1f7be81.8e911"],["6930a9e9.543e88"],["51d22bec.485234"]]},{"id":"6930a9e9.543e88","type":"ui_chart","z":"d00468c7.f49a28","name":"","group":"f3f80c78.df78","order":0,"width":0,"height":0,"label":"순간전류그래프","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"x":520,"y":980,"wires":[[]]},{"id":"51d22bec.485234","type":"ui_chart","z":"d00468c7.f49a28","name":"","group":"f3f80c78.df78","order":0,"width":0,"height":0,"label":"전력량그래프","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"x":520,"y":1020,"wires":[[]]},{"id":"d9d5eff7.b40af","type":"inject","z":"d00468c7.f49a28","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"str","x":110,"y":40,"wires":[["35cbdae0.29fd96"]]},{"id":"ef478ea7.f5617","type":"function","z":"d00468c7.f49a28","name":"","func":"flow.set(\"state\",-999);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":510,"y":260,"wires":[[]]},{"id":"68ce2b74.e403c4","type":"inject","z":"d00468c7.f49a28","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"str","x":170,"y":480,"wires":[["30f49ab3.90b346"]]},{"id":"a9189a1.0f38e68","type":"function","z":"d00468c7.f49a28","name":"","func":"flow.set(\"stime\",-999);\nflow.set(\"wh\",-999);\nflow.set(\"w\",-999);\nflow.set(\"a\",-999);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":310,"y":720,"wires":[[]]},{"id":"b300b90d.5b3268","type":"mqtt-broker","name":"nockanda broker","broker":"broker.mqtt-dashboard.com","port":"1883","clientid":"","usetls":false,"protocolVersion":"4","keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","birthMsg":{},"closeTopic":"","closeQos":"0","closePayload":"","closeMsg":{},"willTopic":"","willQos":"0","willPayload":"","willMsg":{},"sessionExpiry":""},{"id":"dcdc0d14.9c98e","type":"ui_group","name":"Group 9","tab":"b6ba72ff.7f52","order":1,"disp":true,"width":6},{"id":"59341cab.141a64","type":"ui_group","name":"Default","tab":"b633a287.fd0b8","order":1,"disp":true,"width":"8","collapse":false},{"id":"32efad14.604282","type":"MySQLdatabase","name":"","host":"127.0.0.1","port":"3306","db":"arduino286","tz":"","charset":"UTF8"},{"id":"91f945bf.3f26b8","type":"ui_group","name":"Group 2","tab":"b6ba72ff.7f52","order":3,"disp":true,"width":"6","collapse":false},{"id":"f3f80c78.df78","type":"ui_group","name":"Group 2","tab":"b633a287.fd0b8","order":2,"disp":true,"width":6},{"id":"b6ba72ff.7f52","type":"ui_tab","name":"Tab 1","icon":"dashboard","order":1},{"id":"b633a287.fd0b8","type":"ui_tab","name":"Tab 2","icon":"dashboard","order":1,"disabled":false,"hidden":false}]