[{"id":"e8ff81c8.e471","type":"http in","z":"bd4b401b.10ecb","name":"","url":"/update","method":"get","upload":false,"swaggerDoc":"","x":110,"y":460,"wires":[["ef2876c9.05b4c8","617379db.5d0d58"]]},{"id":"1e0b056.f5ce9fb","type":"function","z":"bd4b401b.10ecb","name":"업데이트를 해야하나 말아야하나?","func":"if(msg.req.headers.useragent == \"ESP8266-http-Update\" && msg.req.query.code != null && msg.req.query.code == \"123456\"){\n  //ESP8266보드가 파일서버로 접근한 경우\n  if(msg.req.headers.myversion == \"0.4\"){\n      //이미 최신버전이다\n      msg.statusCode = 304;\n      msg.payload = \"이미최신버전이다!\";\n      return [null,msg];\n  }else{\n      //업데이트 대상자\n      msg.filename = \"C:\\\\Users\\\\wajang\\\\Documents\\\\Arduino\\\\sketch_nov01a\\\\file.bin\";\n      msg.statusCode = 200;\n      return [msg,null];\n  }\n}else{\n  //당신은 누구입니까?\n  msg.statusCode = 405;\n  msg.payload = \"당신은 내가 원하는 디바이스가 아닙니다!\";\n  return [null,msg];\n}\n\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":420,"y":500,"wires":[["71a23cb4.544414"],["74128088.f3426"]]},{"id":"71a23cb4.544414","type":"file in","z":"bd4b401b.10ecb","name":"","filename":"","format":"","chunk":false,"sendError":false,"encoding":"none","x":590,"y":400,"wires":[["74128088.f3426"]]},{"id":"74128088.f3426","type":"http response","z":"bd4b401b.10ecb","name":"","statusCode":"","headers":{},"x":730,"y":500,"wires":[]},{"id":"617379db.5d0d58","type":"debug","z":"bd4b401b.10ecb","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":230,"y":380,"wires":[]},{"id":"ef2876c9.05b4c8","type":"change","z":"bd4b401b.10ecb","name":"","rules":[{"t":"set","p":"req.headers.useragent","pt":"msg","to":"req.headers.user-agent","tot":"msg"},{"t":"set","p":"req.headers.myversion","pt":"msg","to":"req.headers.x-esp8266-version","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":160,"y":640,"wires":[["1e0b056.f5ce9fb"]]}]