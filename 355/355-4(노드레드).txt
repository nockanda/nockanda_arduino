[{"id":"d2cbf1ac.f8246","type":"tab","label":"플로우 1","disabled":false,"info":""},{"id":"156785a7.4f090a","type":"tcp in","z":"d2cbf1ac.f8246","name":"","server":"server","host":"","port":"60000","datamode":"stream","datatype":"utf8","newline":"\\n","topic":"","base64":false,"x":80,"y":120,"wires":[["6805b52.92f774c","ff203727.7a75c8"]]},{"id":"1db0cea4.01dd81","type":"tcp out","z":"d2cbf1ac.f8246","host":"","port":"","beserver":"reply","base64":false,"end":false,"name":"","x":410,"y":80,"wires":[]},{"id":"e17314ee.d45c78","type":"function","z":"d2cbf1ac.f8246","name":"메시지에코","func":"msg.payload = \"[서버응답]\" + msg.payload + \"\\n\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":230,"y":40,"wires":[[]]},{"id":"6805b52.92f774c","type":"function","z":"d2cbf1ac.f8246","name":"클라언트등록","func":"if(msg.payload[0] == '#'){\n   //디바이스 아이디인것이다!\n   //등록을 해야한다!\n   //#OK를 응답한다!\n   msg.payload = msg.payload.replace(\"\\r\",\"\");\n   msg.payload = msg.payload.replace(\"\\n\",\"\");\n   global.set(msg.payload,msg);\n   \n   msg.payload = \"#OK\\n\";\n   return msg;\n}else{\n  return null;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":240,"y":80,"wires":[["1db0cea4.01dd81"]]},{"id":"9dce38b2.f0d2c8","type":"debug","z":"d2cbf1ac.f8246","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":550,"y":400,"wires":[]},{"id":"615d50b3.2be1f","type":"status","z":"d2cbf1ac.f8246","name":"","scope":["156785a7.4f090a"],"x":100,"y":360,"wires":[["a7f31906.a0a5f8"]]},{"id":"a7f31906.a0a5f8","type":"function","z":"d2cbf1ac.f8246","name":"클라이언트가끊어지는부분","func":"if(msg.status.event != \"disconnect\") return null;\n\nvar list = global.keys();\n\n//msg.ip  msg.port\n//msg.status.event (connect,disconnect)\n//msg.status.ip\n//msg.status.port\n\nfor(var i = 0;i<list.length;i++){\n    //list[i]\n    var socket = global.get(list[i]);\n    if(socket != null){\n        if(socket.ip == msg.status.ip && socket.port == msg.status.port){\n            global.set(list[i],undefined);\n            break;\n        }\n    }\n}\n\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":360,"y":360,"wires":[[]]},{"id":"e092a84c.987258","type":"inject","z":"d2cbf1ac.f8246","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":460,"wires":[["fc21f976.84b568"]]},{"id":"fc21f976.84b568","type":"function","z":"d2cbf1ac.f8246","name":"","func":"var list = global.keys();\n\nfor(var i = 0;i<list.length;i++){\n    global.set(list[i],undefined);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":310,"y":460,"wires":[[]]},{"id":"3730de57.cfd132","type":"inject","z":"d2cbf1ac.f8246","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":260,"wires":[["bec09aeb.e4eff8"]]},{"id":"bec09aeb.e4eff8","type":"function","z":"d2cbf1ac.f8246","name":"클라이언트목록조회","func":"msg.payload = global.keys();\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":310,"y":260,"wires":[["d25c50b7.86456"]]},{"id":"d25c50b7.86456","type":"ui_list","z":"d2cbf1ac.f8246","group":"aa2634f1.1bbfd8","name":"","order":0,"width":"6","height":"6","lineType":"two","actionType":"click","allowHTML":false,"outputs":1,"topic":"","x":490,"y":260,"wires":[[]]},{"id":"ff203727.7a75c8","type":"function","z":"d2cbf1ac.f8246","name":"일반메시지","func":"if(msg.payload[0] == '#') return null;\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":230,"y":180,"wires":[["a0c29455.e2a5a8"]]},{"id":"9f97258b.f4b938","type":"debug","z":"d2cbf1ac.f8246","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload.msg","targetType":"msg","statusVal":"","statusType":"auto","x":570,"y":140,"wires":[]},{"id":"a0c29455.e2a5a8","type":"json","z":"d2cbf1ac.f8246","name":"","property":"payload","action":"","pretty":false,"x":390,"y":180,"wires":[["505c251b.0e745c","9f97258b.f4b938"]]},{"id":"505c251b.0e745c","type":"function","z":"d2cbf1ac.f8246","name":"","func":"var socket = global.get(msg.payload.to);\n\nif(socket != null){\n    socket.payload = \"{\\\"from\\\":\\\"\"+msg.payload.from+\"\\\",\\\"msg\\\":\\\"\"+msg.payload.msg+\"\\\"}\\n\";\n    return socket;\n}else{\n    return null;\n}\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":540,"y":180,"wires":[["159d62b6.c75ffd"]]},{"id":"159d62b6.c75ffd","type":"tcp out","z":"d2cbf1ac.f8246","host":"","port":"","beserver":"reply","base64":false,"end":false,"name":"","x":610,"y":80,"wires":[]},{"id":"aa2634f1.1bbfd8","type":"ui_group","name":"Group 1","tab":"d25c9cdc.bf5cd","order":1,"disp":true,"width":6},{"id":"d25c9cdc.bf5cd","type":"ui_tab","name":"Tab 1","icon":"dashboard","order":1}]