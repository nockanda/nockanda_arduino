[{"id":"e8ff81c8.e471","type":"http in","z":"bd4b401b.10ecb","name":"","url":"/update","method":"get","upload":false,"swaggerDoc":"","x":110,"y":120,"wires":[["ef2876c9.05b4c8","617379db.5d0d58"]]},{"id":"1e0b056.f5ce9fb","type":"function","z":"bd4b401b.10ecb","name":"업데이트를 해야하나 말아야하나?","func":"if(msg.req.headers.useragent == \"ESP8266-http-Update\" && msg.req.query.code != null && msg.req.query.code == \"123456\"){\n  //ESP8266보드가 파일서버로 접근한 경우\n  if(msg.req.headers.myversion == \"0.2\"){\n      //이미 최신버전이다\n      msg.statusCode = 304;\n      msg.payload = \"이미최신버전이다!\";\n      return [null,msg];\n  }else{\n      //업데이트 대상자\n\n      msg.filename = \"C:\\\\Users\\\\wajang\\\\esp8266\\\\file.bin\";\n      msg.statusCode = 200;\n      return [msg,null];\n  }\n}else{\n  //당신은 누구입니까?\n  msg.statusCode = 405;\n  msg.payload = \"당신은 내가 원하는 디바이스가 아닙니다!\";\n  return [null,msg];\n}\n\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":540,"y":160,"wires":[[],[]]},{"id":"71a23cb4.544414","type":"file in","z":"bd4b401b.10ecb","name":"","filename":"","format":"","chunk":false,"sendError":false,"encoding":"none","x":1670,"y":300,"wires":[["74128088.f3426"]]},{"id":"74128088.f3426","type":"http response","z":"bd4b401b.10ecb","name":"","statusCode":"","headers":{},"x":1810,"y":560,"wires":[]},{"id":"617379db.5d0d58","type":"debug","z":"bd4b401b.10ecb","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":370,"y":100,"wires":[]},{"id":"ef2876c9.05b4c8","type":"change","z":"bd4b401b.10ecb","name":"하이픈을 제거하는 작업(별로중요하지 않음)","rules":[{"t":"set","p":"req.headers.useragent","pt":"msg","to":"req.headers.user-agent","tot":"msg"},{"t":"set","p":"req.headers.myversion","pt":"msg","to":"req.headers.x-esp8266-version","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":250,"y":240,"wires":[["f8929776.5447c8"]]},{"id":"f8929776.5447c8","type":"switch","z":"bd4b401b.10ecb","name":"너가 ESP8266이 맞느냐?","property":"req.headers.useragent","propertyType":"msg","rules":[{"t":"eq","v":"ESP8266-http-Update","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":210,"y":320,"wires":[["62be7c34.1ae4d4"],["d01f07dc.2a7658"]]},{"id":"d01f07dc.2a7658","type":"change","z":"bd4b401b.10ecb","name":"405코드 반환","rules":[{"t":"set","p":"statusCode","pt":"msg","to":"405","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1170,"y":600,"wires":[["74128088.f3426"]]},{"id":"62be7c34.1ae4d4","type":"switch","z":"bd4b401b.10ecb","name":"너의 시리얼번호가 무엇이냐?","property":"req.query.serial","propertyType":"msg","rules":[{"t":"eq","v":"nockanda01","vt":"str"},{"t":"eq","v":"nockanda02","vt":"str"},{"t":"eq","v":"nockanda03","vt":"str"},{"t":"eq","v":"nockanda04","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":5,"x":590,"y":320,"wires":[["a09d1196.ab2e8"],["49c67ebe.9cc03"],["62ea8e17.93b5"],["a8b73107.8ef11"],["d01f07dc.2a7658"]]},{"id":"a09d1196.ab2e8","type":"switch","z":"bd4b401b.10ecb","name":"너의비밀번호는 무엇이냐?","property":"req.query.code","propertyType":"msg","rules":[{"t":"eq","v":"123456","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":900,"y":260,"wires":[["e99b21fa.ff30d"],["d01f07dc.2a7658"]]},{"id":"e99b21fa.ff30d","type":"switch","z":"bd4b401b.10ecb","name":"너의 버전이 몇이냐?","property":"req.headers.myversion","propertyType":"msg","rules":[{"t":"neq","v":"0.2","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1180,"y":240,"wires":[["9e47a62f.e2b828"],["887e8c36.64aed"]]},{"id":"49c67ebe.9cc03","type":"switch","z":"bd4b401b.10ecb","name":"너의비밀번호는 무엇이냐?","property":"req.query.code","propertyType":"msg","rules":[{"t":"eq","v":"123456","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":900,"y":300,"wires":[["3439775b.6da108"],["d01f07dc.2a7658"]]},{"id":"62ea8e17.93b5","type":"switch","z":"bd4b401b.10ecb","name":"너의비밀번호는 무엇이냐?","property":"req.query.code","propertyType":"msg","rules":[{"t":"eq","v":"123456","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":900,"y":340,"wires":[["46e8bf43.d4c69"],["d01f07dc.2a7658"]]},{"id":"a8b73107.8ef11","type":"switch","z":"bd4b401b.10ecb","name":"너의비밀번호는 무엇이냐?","property":"req.query.code","propertyType":"msg","rules":[{"t":"eq","v":"123456","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":900,"y":380,"wires":[["5da5445f.8bc52c"],["d01f07dc.2a7658"]]},{"id":"3439775b.6da108","type":"switch","z":"bd4b401b.10ecb","name":"너의 버전이 몇이냐?","property":"req.headers.myversion","propertyType":"msg","rules":[{"t":"neq","v":"0.2","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1180,"y":280,"wires":[["2e01d3ab.85f30c"],["887e8c36.64aed"]]},{"id":"46e8bf43.d4c69","type":"switch","z":"bd4b401b.10ecb","name":"너의 버전이 몇이냐?","property":"req.headers.myversion","propertyType":"msg","rules":[{"t":"neq","v":"0.1","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1180,"y":320,"wires":[["6177a792.eaacc8"],["887e8c36.64aed"]]},{"id":"5da5445f.8bc52c","type":"switch","z":"bd4b401b.10ecb","name":"너의 버전이 몇이냐?","property":"req.headers.myversion","propertyType":"msg","rules":[{"t":"neq","v":"0.1","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1180,"y":360,"wires":[["aedd29c3.a81788"],["887e8c36.64aed"]]},{"id":"887e8c36.64aed","type":"change","z":"bd4b401b.10ecb","name":"304코드 반환","rules":[{"t":"set","p":"statusCode","pt":"msg","to":"304","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1210,"y":520,"wires":[["74128088.f3426"]]},{"id":"9e47a62f.e2b828","type":"change","z":"bd4b401b.10ecb","name":"업데이트파일명대입","rules":[{"t":"set","p":"filename","pt":"msg","to":"C:\\Users\\wajang\\esp8266\\nockanda01.bin","tot":"str"},{"t":"set","p":"statusCode","pt":"msg","to":"200","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1440,"y":240,"wires":[["71a23cb4.544414","129569c8.4cf426"]]},{"id":"2e01d3ab.85f30c","type":"change","z":"bd4b401b.10ecb","name":"업데이트파일명대입","rules":[{"t":"set","p":"filename","pt":"msg","to":"C:\\Users\\wajang\\esp8266\\nockanda02.bin","tot":"str"},{"t":"set","p":"statusCode","pt":"msg","to":"200","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1440,"y":280,"wires":[["71a23cb4.544414"]]},{"id":"6177a792.eaacc8","type":"change","z":"bd4b401b.10ecb","name":"업데이트파일명대입","rules":[{"t":"set","p":"filename","pt":"msg","to":"C:\\Users\\wajang\\esp8266\\nockanda03.bin","tot":"str"},{"t":"set","p":"statusCode","pt":"msg","to":"200","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1440,"y":320,"wires":[["71a23cb4.544414"]]},{"id":"aedd29c3.a81788","type":"change","z":"bd4b401b.10ecb","name":"업데이트파일명대입","rules":[{"t":"set","p":"filename","pt":"msg","to":"C:\\Users\\wajang\\esp8266\\nockanda04.bin","tot":"str"},{"t":"set","p":"statusCode","pt":"msg","to":"200","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1440,"y":360,"wires":[["71a23cb4.544414"]]},{"id":"129569c8.4cf426","type":"debug","z":"bd4b401b.10ecb","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1560,"y":140,"wires":[]},{"id":"88b6c660.494458","type":"mqtt in","z":"bd4b401b.10ecb","name":"","topic":"nockanda/nockanda01/data","qos":"2","datatype":"auto","broker":"8f4f6e74.2997a","nl":false,"rap":true,"rh":0,"x":260,"y":500,"wires":[["c103ad13.c9464"]]},{"id":"c103ad13.c9464","type":"ui_text","z":"bd4b401b.10ecb","group":"56b1c5df.c7369c","order":0,"width":0,"height":0,"name":"","label":"디바이스1수신메시지","format":"{{msg.payload}}","layout":"row-spread","className":"","x":530,"y":500,"wires":[]},{"id":"d7ae84c0.091668","type":"mqtt out","z":"bd4b401b.10ecb","name":"","topic":"nockanda/nockanda01/reboot","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"8f4f6e74.2997a","x":550,"y":540,"wires":[]},{"id":"72d575b9.f6e1bc","type":"ui_button","z":"bd4b401b.10ecb","name":"","group":"56b1c5df.c7369c","order":1,"width":0,"height":0,"passthru":false,"label":"보드1번ESP8266업데이트!","tooltip":"","color":"","bgcolor":"","className":"","icon":"","payload":"0","payloadType":"str","topic":"topic","topicType":"msg","x":260,"y":540,"wires":[["d7ae84c0.091668"]]},{"id":"709a1260.93d8ec","type":"mqtt in","z":"bd4b401b.10ecb","name":"","topic":"nockanda/nockanda02/data","qos":"2","datatype":"auto","broker":"8f4f6e74.2997a","nl":false,"rap":true,"rh":0,"x":260,"y":600,"wires":[["8e8bcfda.6871a"]]},{"id":"8e8bcfda.6871a","type":"ui_text","z":"bd4b401b.10ecb","group":"56b1c5df.c7369c","order":0,"width":0,"height":0,"name":"","label":"디바이스2수신메시지","format":"{{msg.payload}}","layout":"row-spread","className":"","x":540,"y":600,"wires":[]},{"id":"3beb1e77.a139b2","type":"mqtt in","z":"bd4b401b.10ecb","name":"","topic":"nockanda/nockanda03/data","qos":"2","datatype":"auto","broker":"8f4f6e74.2997a","nl":false,"rap":true,"rh":0,"x":260,"y":700,"wires":[["8c3932af.779b5"]]},{"id":"8c3932af.779b5","type":"ui_text","z":"bd4b401b.10ecb","group":"56b1c5df.c7369c","order":0,"width":0,"height":0,"name":"","label":"디바이스3수신메시지","format":"{{msg.payload}}","layout":"row-spread","className":"","x":540,"y":700,"wires":[]},{"id":"badb6f6c.c291f","type":"mqtt in","z":"bd4b401b.10ecb","name":"","topic":"nockanda/nockanda04/data","qos":"2","datatype":"auto","broker":"8f4f6e74.2997a","nl":false,"rap":true,"rh":0,"x":260,"y":820,"wires":[["92b63b26.a47208"]]},{"id":"92b63b26.a47208","type":"ui_text","z":"bd4b401b.10ecb","group":"56b1c5df.c7369c","order":0,"width":0,"height":0,"name":"","label":"디바이스4수신메시지","format":"{{msg.payload}}","layout":"row-spread","className":"","x":540,"y":820,"wires":[]},{"id":"3ec3713e.88213e","type":"ui_button","z":"bd4b401b.10ecb","name":"","group":"56b1c5df.c7369c","order":1,"width":0,"height":0,"passthru":false,"label":"보드2번ESP8266업데이트!","tooltip":"","color":"","bgcolor":"","className":"","icon":"","payload":"0","payloadType":"str","topic":"topic","topicType":"msg","x":260,"y":640,"wires":[["423ce8c9.dd4378"]]},{"id":"423ce8c9.dd4378","type":"mqtt out","z":"bd4b401b.10ecb","name":"","topic":"nockanda/nockanda02/reboot","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"8f4f6e74.2997a","x":570,"y":640,"wires":[]},{"id":"698ff8ab.3b3ce8","type":"ui_button","z":"bd4b401b.10ecb","name":"","group":"56b1c5df.c7369c","order":1,"width":0,"height":0,"passthru":false,"label":"보드3번ESP8266업데이트!","tooltip":"","color":"","bgcolor":"","className":"","icon":"","payload":"0","payloadType":"str","topic":"topic","topicType":"msg","x":260,"y":760,"wires":[["a8dc5df2.f43d4"]]},{"id":"a8dc5df2.f43d4","type":"mqtt out","z":"bd4b401b.10ecb","name":"","topic":"nockanda/nockanda03/reboot","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"8f4f6e74.2997a","x":570,"y":760,"wires":[]},{"id":"e24e854a.7708f8","type":"ui_button","z":"bd4b401b.10ecb","name":"","group":"56b1c5df.c7369c","order":1,"width":0,"height":0,"passthru":false,"label":"보드4번ESP8266업데이트!","tooltip":"","color":"","bgcolor":"","className":"","icon":"","payload":"0","payloadType":"str","topic":"topic","topicType":"msg","x":260,"y":880,"wires":[["a8e71765.4d1b48"]]},{"id":"a8e71765.4d1b48","type":"mqtt out","z":"bd4b401b.10ecb","name":"","topic":"nockanda/nockanda04/reboot","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"8f4f6e74.2997a","x":570,"y":880,"wires":[]},{"id":"a9f74035.be192","type":"mqtt out","z":"bd4b401b.10ecb","name":"","topic":"nockanda/nockanda01/input","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"8f4f6e74.2997a","x":540,"y":980,"wires":[]},{"id":"33ac8e36.0dc4e2","type":"ui_switch","z":"bd4b401b.10ecb","name":"","label":"디바이스1_LED1","tooltip":"","group":"768dc700.d5e528","order":0,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"topic","topicType":"msg","style":"","onvalue":"11","onvalueType":"str","onicon":"","oncolor":"","offvalue":"10","offvalueType":"str","officon":"","offcolor":"","animate":false,"className":"","x":250,"y":980,"wires":[["a9f74035.be192"]]},{"id":"489594e9.2b1f9c","type":"ui_switch","z":"bd4b401b.10ecb","name":"","label":"디바이스1_LED2","tooltip":"","group":"768dc700.d5e528","order":0,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"topic","topicType":"msg","style":"","onvalue":"21","onvalueType":"str","onicon":"","oncolor":"","offvalue":"20","offvalueType":"str","officon":"","offcolor":"","animate":false,"className":"","x":250,"y":1020,"wires":[["a9f74035.be192"]]},{"id":"cb5bec57.0d82","type":"mqtt out","z":"bd4b401b.10ecb","name":"","topic":"nockanda/nockanda02/input","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"8f4f6e74.2997a","x":540,"y":1080,"wires":[]},{"id":"837ca7aa.97cd78","type":"ui_switch","z":"bd4b401b.10ecb","name":"","label":"디바이스2_LED1","tooltip":"","group":"768dc700.d5e528","order":0,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"topic","topicType":"msg","style":"","onvalue":"11","onvalueType":"str","onicon":"","oncolor":"","offvalue":"10","offvalueType":"str","officon":"","offcolor":"","animate":false,"className":"","x":250,"y":1080,"wires":[["cb5bec57.0d82"]]},{"id":"d502833a.76d76","type":"ui_switch","z":"bd4b401b.10ecb","name":"","label":"디바이스2_LED2","tooltip":"","group":"768dc700.d5e528","order":0,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"topic","topicType":"msg","style":"","onvalue":"21","onvalueType":"str","onicon":"","oncolor":"","offvalue":"20","offvalueType":"str","officon":"","offcolor":"","animate":false,"className":"","x":250,"y":1120,"wires":[["cb5bec57.0d82"]]},{"id":"1a66f099.17970f","type":"mqtt out","z":"bd4b401b.10ecb","name":"","topic":"nockanda/nockanda03/input","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"8f4f6e74.2997a","x":540,"y":1260,"wires":[]},{"id":"eb429c48.61ce1","type":"ui_switch","z":"bd4b401b.10ecb","name":"","label":"디바이스3_LED1","tooltip":"","group":"768dc700.d5e528","order":0,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"topic","topicType":"msg","style":"","onvalue":"11","onvalueType":"str","onicon":"","oncolor":"","offvalue":"10","offvalueType":"str","officon":"","offcolor":"","animate":false,"className":"","x":250,"y":1260,"wires":[["1a66f099.17970f"]]},{"id":"b37c2e84.fcf9c","type":"ui_switch","z":"bd4b401b.10ecb","name":"","label":"디바이스3_LED2","tooltip":"","group":"768dc700.d5e528","order":0,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"topic","topicType":"msg","style":"","onvalue":"21","onvalueType":"str","onicon":"","oncolor":"","offvalue":"20","offvalueType":"str","officon":"","offcolor":"","animate":false,"className":"","x":250,"y":1300,"wires":[["1a66f099.17970f"]]},{"id":"73385656.9a58f8","type":"mqtt out","z":"bd4b401b.10ecb","name":"","topic":"nockanda/nockanda04/input","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"8f4f6e74.2997a","x":540,"y":1360,"wires":[]},{"id":"76509b6c.b2b664","type":"ui_switch","z":"bd4b401b.10ecb","name":"","label":"디바이스4_LED1","tooltip":"","group":"768dc700.d5e528","order":0,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"topic","topicType":"msg","style":"","onvalue":"11","onvalueType":"str","onicon":"","oncolor":"","offvalue":"10","offvalueType":"str","officon":"","offcolor":"","animate":false,"className":"","x":250,"y":1360,"wires":[["73385656.9a58f8"]]},{"id":"9435f323.26437","type":"ui_switch","z":"bd4b401b.10ecb","name":"","label":"디바이스4_LED2","tooltip":"","group":"768dc700.d5e528","order":0,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"topic","topicType":"msg","style":"","onvalue":"21","onvalueType":"str","onicon":"","oncolor":"","offvalue":"20","offvalueType":"str","officon":"","offcolor":"","animate":false,"className":"","x":250,"y":1400,"wires":[["73385656.9a58f8"]]},{"id":"83436791.e26808","type":"mqtt in","z":"bd4b401b.10ecb","name":"","topic":"nockanda/nockanda01/dht11","qos":"2","datatype":"auto","broker":"8f4f6e74.2997a","nl":false,"rap":true,"rh":0,"x":240,"y":460,"wires":[["e317f8e1.b81e58"]]},{"id":"9e5aebfc.ff5038","type":"ui_text","z":"bd4b401b.10ecb","group":"56b1c5df.c7369c","order":0,"width":0,"height":0,"name":"","label":"디바이스1습도","format":"{{msg.payload.col1}}","layout":"row-spread","className":"","x":520,"y":460,"wires":[]},{"id":"e317f8e1.b81e58","type":"csv","z":"bd4b401b.10ecb","name":"","sep":",","hdrin":"","hdrout":"none","multi":"one","ret":"\\n","temp":"","skip":"0","strings":true,"include_empty_strings":"","include_null_values":"","x":290,"y":400,"wires":[["bcb24d3e.51b72","9e5aebfc.ff5038"]]},{"id":"bcb24d3e.51b72","type":"ui_text","z":"bd4b401b.10ecb","group":"56b1c5df.c7369c","order":0,"width":0,"height":0,"name":"","label":"디바이스1온도","format":"{{msg.payload.col2}}","layout":"row-spread","className":"","x":480,"y":420,"wires":[]},{"id":"ad0ef5b6.752178","type":"mqtt out","z":"bd4b401b.10ecb","name":"","topic":"nockanda/nockanda02/servo","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"8f4f6e74.2997a","x":540,"y":1160,"wires":[]},{"id":"139e123c.201cce","type":"ui_button","z":"bd4b401b.10ecb","name":"","group":"768dc700.d5e528","order":8,"width":0,"height":0,"passthru":false,"label":"디바이스2_서보UP","tooltip":"","color":"","bgcolor":"","className":"","icon":"","payload":"U","payloadType":"str","topic":"topic","topicType":"msg","x":270,"y":1160,"wires":[["ad0ef5b6.752178"]]},{"id":"ad61e04c.de643","type":"ui_button","z":"bd4b401b.10ecb","name":"","group":"768dc700.d5e528","order":8,"width":0,"height":0,"passthru":false,"label":"디바이스2_서보DN","tooltip":"","color":"","bgcolor":"","className":"","icon":"","payload":"D","payloadType":"str","topic":"topic","topicType":"msg","x":270,"y":1200,"wires":[["ad0ef5b6.752178"]]},{"id":"8f4f6e74.2997a","type":"mqtt-broker","name":"","broker":"broker.mqtt-dashboard.com","port":"1883","clientid":"","usetls":false,"protocolVersion":"4","keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","birthMsg":{},"closeTopic":"","closeQos":"0","closePayload":"","closeMsg":{},"willTopic":"","willQos":"0","willPayload":"","willMsg":{},"sessionExpiry":""},{"id":"56b1c5df.c7369c","type":"ui_group","name":"Group 1","tab":"805ccb9d.42cd18","order":1,"disp":true,"width":6},{"id":"768dc700.d5e528","type":"ui_group","name":"Group 2","tab":"805ccb9d.42cd18","order":2,"disp":true,"width":6},{"id":"805ccb9d.42cd18","type":"ui_tab","name":"Tab 5","icon":"dashboard","order":5}]